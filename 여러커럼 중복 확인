SELECT  TRAY_ID             AS ALRAM_CD, --코드 
        LOC                 AS FLOOR_LOC,--위치 
        NVL(TO_CHAR(CREATE_DTTM, 'YYYY-MM-DD HH24:MI:SS'), 0) AS CREATE_DTTM,
        NVL(TO_CHAR(STORE_DTTM, 'YYYY-MM-DD HH24:MI:SS'), 0)  AS START_DTTM
FROM
(
    SELECT LOC, TRAY_ID, CREATE_DTTM, STORE_DTTM, 
           COUNT(*) OVER(PARTITION BY TRAY_ID) AS OVERLAP,
           ROW_NUMBER() OVER(PARTITION BY TRAY_ID ORDER BY STORE_DTTM) AS RN 
    FROM (
        SELECT TRAY_ID1 AS TRAY_ID, LOC, CREATE_DTTM, STORE_DTTM FROM TB_INV_STOCK WHERE TRAY_ID1 IS NOT NULL
            UNION ALL
        SELECT TRAY_ID2 AS TRAY_ID, LOC, CREATE_DTTM, STORE_DTTM FROM TB_INV_STOCK WHERE TRAY_ID2 IS NOT NULL
            UNION ALL
        SELECT TRAY_ID3 AS TRAY_ID, LOC, CREATE_DTTM, STORE_DTTM FROM TB_INV_STOCK WHERE TRAY_ID3 IS NOT NULL
        ) 
    ORDER BY TRAY_ID, STORE_DTTM ASC
) TIS
WHERE TIS.OVERLAP > 1
AND TIS.RN = 1;

